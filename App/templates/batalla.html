{% extends "base.html" %}

{% block title %}Batalla Pokémon{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='batalla.css') }}">
{% endblock %}

{% block content %}

    <div class="character-name">
      <p><strong>{{ batalla.trainer_name }}</strong></p>
    <div class="character-player">
       <img src="{{ url_for('static', filename=batalla.character_img) }}" alt="Jugador" class="character-sprite">
    </div>
    </div>
    <div class="enemy-name">
      <p><strong>{{ batalla.enemy_name }}</strong></p>
       <div class="enemy-player">
         <img src="{{ url_for('static', filename=batalla.enemy_img) }}" alt="Rival" class="enemy-sprite">
       </div>
    </div>

    <!-- enemigo -->
    <div class="enemigo-area">
      <div class="enemigo-info">
        <h2>{{ batalla.datos_pokemon_rival.name | title }}</h2>
        <div class="hp-barra">
          {% set hp_percent_rival = (batalla.vida_rival / batalla.vida_max_rival) * 100 %}
          <div class="hp-contenido" style="width: {{ hp_percent_rival }}%;"></div>
        </div>
        <p class="hp-texto">{{ batalla.vida_rival }} / {{ batalla.vida_max_rival }}</p>
      </div>
      <img src="{{ batalla.datos_pokemon_rival.sprites.front_default }}" alt="{{ batalla.datos_pokemon_rival.name }}" class="pokemon-sprite enemigo-sprite">
    </div>

    <!-- jugador -->
    <div class="player-area">
        <div class="player-info">
          <h2>{{ batalla.datos_pokemon_jugador.name | title }}</h2>
          <div class="hp-barra">
            {% set hp_percent_jugador = (batalla.vida_jugador / batalla.vida_max_jugador) * 100 %}
            <div class="hp-contenido" style="width: {{ hp_percent_jugador }}%;"></div>
          </div>
          <p class="hp-texto">{{ batalla.vida_jugador }} / {{ batalla.vida_max_jugador }}</p>
        </div>
        <img src="{{ batalla.datos_pokemon_jugador.sprites.back_default }}" alt="{{ batalla.datos_pokemon_jugador.name }}" class="player-sprite">
    </div>

    <!-- panel inferior -->
    <div class="battle-panel">
        
        <!-- ÁREA DEL LOG -->

        <div class="battle-log-area">
            <div class="battle-log-messages">
                <!-- Mostramos el log en orden inverso (lo más nuevo arriba) -->
                {% for mensaje in batalla.log | reverse %}
                    <p>{{ mensaje }}</p>
                {% endfor %}
            </div>
        </div>
        <div class="battle-prompt">
            <p><strong>
                {% if batalla.partida_terminada %}
                    ¡La batalla ha terminado!
                {% else %}
                    ¿Qué debería hacer {{ batalla.datos_pokemon_jugador.name | title }}?
                {% endif %}
            </strong></p>
        </div>

        <!-- 3. Los Ataques (Las acciones) -->
        <div class="ataques">
            {% if not batalla.partida_terminada %}
                <!-- Si la partida NO ha terminado, muestra los botones -->
                {% for move in batalla.ataques_jugador %}
                <div class="movimientos {{ move.type }}">
                    <form action="{{ url_for('atacar') }}" method="POST">
                        <input type="hidden" name="ataque" value="{{ move.name }}">
                        <button type="submit" class="tipo-icono">
                            <div class="attack">
                                <p class="move-name">{{ move.name.replace('-', ' ').replace('special', 'Especial').title() }}</p>
                                <img src="{{ url_for('static', filename='imagenes/' ~ move.type ~ '.png') }}" alt="{{ move.type }}" class="icono-move">
                            </div>
                            <br>
                            <div class="stat">
                                <p>Poder: {{ move.power or '—' }}</p>
                                <p>Accuracy: {{ move.accuracy or '—' }}%</p>
                            </div>
                        </button>
                    </form>
                </div>
                {% endfor %}
            {% else %}
                <!-- Si la partida HA terminado, muestra un botón para volver -->
                <div class="movimientos normal" style="width: 100%;">
                     <form action="{{ url_for('pokemons_bp.lista') }}" method="GET">
                        <button type="submit" class="tipo-icono" style="width: 100%; justify-content: center;">
                            <div class="attack" style="text-align: center;">
                                <p class="move-name">Volver a la Lista</p>
                            </div>
                        </button>
                    </form>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}